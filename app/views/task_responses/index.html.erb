<%= button_to "Download Spreadsheet", {action: "download_csv_data", question_id: @question.id},
              class: "btn btn-primary btn-lg", form_class: 'download-spreadsheet-btn', format: :xlsx, method: :get %>
<h1>
  Student Responses
</h1>
<% if params['task']!=nil %>
    <%= render partial: "task_param_set_index" %>
<% elsif params['question']!=nil %>
    <div id="assessment-question-response-index-container">
      <div id="titles">
        <%= link_to @activity.title, activity_page_path(@activity) %>
        <br>
        <%= link_to @task.title, assessment_task_path(@task) %>
      </div>
      <div id="other-question-links">
        <% @other_questions.each { |oq| %>
            <% title = oq.title %>
            <% oq.children.each { |x| title+=", #{x.title}" } %>
            <div class="other-link-tab">
              <%= link_to title, task_responses_path(question: oq), class: "btn btn-default" %>
            </div>
        <% } %>
      </div>
      <div class="student-body">
        <%= @task.student_body.html_safe %>
      </div>
      <% unless @questions.count == 1 %>
          <div id="variant-number">
            There are <%= @questions.count %> variants to this question.
          </div>
      <% end %>
      <% @charts.each { |c| %>
          <div>
            <%= column_chart c[:chart], {library: {
                    hAxis: {title: "#{c[:question_title]}, Correct: #{c[:correct_answer]}"},
                    vAxis: {title: "# of students who chose"},
                    colors: ["#196419"]
            }} %>
          </div>
      <% } %>
      <% @questions.each { |x| %>
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">
                <%= link_to x.title, assessment_question_path(x) %>
                <% unless @question.question_type == "freeResponse" %>
                    <div>
                      <%= render partial: "correct_answers", locals: {question: x} %>
                    </div>
                <% end %>
              </h3>
            </div>
            <div class="panel-body">
              <table class="responses-table sortable" style="width:100%">
                <thead>
                <tr>
                  <th>
                    School
                  </th>
                  <th>
                    Class
                  </th>
                  <th>
                    Student Number
                  </th>
                  <th>
                    <% unless @question.question_type == "freeResponse" %>
                        Answer
                    <% else %>
                        Student Response
                    <% end %>
                  </th>
                </tr>
                </thead>
                <tbody>
                <!--I have a massive table here but it takes a while to load so I will disable while doing other things -->
                <%= render partial: "responses_table_row", collection: @responses.where(assessment_question: x), locals: {type: @question.question_type}, as: 'response' %>
                </tbody>
              </table>
            </div>
          </div>
      <% } %>
    </div>
<% else %>
    <%= render partial: "task_param_not_set_index" %>
<% end %>